# Adsorb Synthesis — Inverse Design via Bayesian Optimization

Эта система позволяет находить рецепты синтеза MOF (металл-органических каркасов) по заданным целевым свойствам.
Подход основан на комбинации **Прямой модели (Forward Model)**, обученной на данных, и **Байесовской оптимизации (Optuna)** для поиска в пространстве рецептов.

---

## Быстрый старт

### 1. Установка окружения
Проект использует `venv`. Установите зависимости:

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 2. Обучение «Симулятора» (Forward Model)
Перед первым запуском нужно обучить модели, которые предсказывают свойства по рецепту.

```bash
PYTHONPATH=src python scripts/train_forward_model.py \
    --data data/SEC_SYN_with_features.csv \
    --output artifacts/forward_models
```
*Это создаст обученные модели CatBoost в папке `artifacts/forward_models`.*

### 3. Поиск рецепта (Inverse Design)
Теперь можно искать рецепт под конкретные свойства.
Например, нужен материал с объемом микропор $W_0 = 0.5$ см³/г и энергией адсорбции $E_0 = 25$ кДж/моль.

```bash
PYTHONPATH=src python scripts/run_bayes_opt.py \
    --W0 0.5 \
    --E0 25 \
    --trials 200 \
    --output predictions.csv
```

Скрипт запустит оптимизацию и сохранит лучшие найденные рецепты в `predictions.csv`.

---

## Структура репозитория

```
├── scripts/
│   ├── train_forward_model.py  # Обучение прямой модели (Рецепт -> Свойства)
│   └── run_bayes_opt.py        # Байесовская оптимизация (Свойства -> Рецепт)
├── src/adsorb_synthesis/
│   ├── constants.py            # Конфигурация и списки признаков
│   ├── data_processing.py      # Подготовка данных
│   └── ...                     # (Утилиты из legacy-пайплайна)
├── data/                       # Данные
└── artifacts/                  # Сохраненные модели
```

## Как это работает

1.  **Data Flip:** Мы не учим модель "Свойства -> Рецепт" (это плохо работает из-за проблемы "один-ко-многим"). Вместо этого мы учим модель "Рецепт -> Свойства".
2.  **Forward Model:** Используется `CatBoostRegressor` для каждого свойства ($W_0, E_0, S_{BET}, x_0$).
3.  **Optimization:** `Optuna` генерирует тысячи вариантов рецептов (металл, лиганд, температура, растворитель), прогоняет их через Forward Model и минимизирует разницу между предсказанными и желаемыми свойствами.

## Результаты
Результат работы — CSV файл с Топ-10 рецептов, отсортированных по Loss (ошибке).
Вы увидите:
*   Параметры синтеза (Металл, Лиганд, Массы, Температуры).
*   Предсказанные свойства (`Pred_W0`, `Pred_E0` и т.д.).
