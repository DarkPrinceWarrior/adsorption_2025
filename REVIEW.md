**Кратко**
- В `src/adsorb_synthesis/data_processing.py:add_thermodynamic_features` термодинамика реализована неверно: запасной расчёт `K_eq = exp(E/(R·T))` и `Delta_G = -E` не имеют физического смысла, поэтому производные столбцы (`K_equilibrium`, `Delta_G_equilibrium`, `Delta_G_residual`) недостоверны.
- План SALT_MASS_FIX реализован частично: колонка `log_salt_mass` добавлена, но обучение/инференс в лог-пространстве и квантильная регрессия из `specs/SALT_MASS_FIX.md` и `specs/LOG_TRANSFORM_INFO.txt` не подключены.
- Несоответствие инженерии признаков train↔BO: `Supersaturation_Index` в обучении = `Molarity_Metal * Molarity_Ligand`, в `scripts/run_bayes_opt.py` используется другая формула с гидратацией, что ведёт к дрейфу признаков на инференсе.
- Физические проверки слабые: дефолтный режим валидации “warn”, `scripts/validate_physics_constraints.py` вызывает отсутствующий `adsorb_synthesis.physics_losses`, в BO нет проверки точек кипения растворителей и целевых стехиометрий, допускаются физически невозможные рецепты.
- UQ и BO слабо связаны: ансамбль — пять CatBoost на одном разбиении с разными сидами, дисперсия отражает только стохастику; в BO неопределённость не используется.

**Схема потока**
Данные CSV → `load_dataset` (молярные массы, термофичи, адсорбционные фичи, категории, соль/физхимия, валидация) → `build_lookup_tables` → `prepare_forward_dataset` (логи, дескрипторы, engineered features) → `scripts/train_forward_model.py` (стратификация, отбор признаков, 5×CatBoost/таргет → `artifacts/forward_models`) → `scripts/run_bayes_opt.py` (Optuna TPE, ручное построение признаков, ансамблевые предсказания) → `predictions_bo.csv`.

**Химия и физика**
- Стехиометрия: `R_molar` = n_salt/n_acid; число координационных узлов лиганда (`carboxyl_groups`) и `STOICHIOMETRY_TARGETS` из `constants.py` не используются — химически обязательные соотношения (например, Zr–BDC 1:1) не контролируются. В `add_physicochemical_descriptors` неизвестные коэффициенты гидратации заменяются на 0, смешивая “неизвестно” с “безводно”.
- Supersaturation: уже в обучении размерность неверна (mol²/L² вместо безразмерной величины), а в BO формула другая (с гидратацией и иной нормировкой), что создаёт дрейф распределения признака.
- Электронные дескрипторы: `d_electrons`, `Jahn_Teller_Active` предполагаются в CSV, но не вычисляются и не валидируются; степени окисления не проверяются.
- Термодинамика: использование Dubinin-энергии `E` как Gibbs приводит к бессмысленным `K_equilibrium` и `Delta_G`; корректно оставлять NaN или вычислять $\Delta G = -RT \ln K$ только при наличии измеренного $K$.
- Валидация: режим по умолчанию “warn”; строки с $W_s < W_0$ или $T_{syn}$ выше точки кипения растворителя могут попасть в обучение.

**ML и BO**
- UQ: ансамбль на одном train/test-разбиении — плохой охват эпистемической неопределённости; нет бутстрапа/оут-оф-фолд, нет калибровки σ.
- Отбор признаков: VIF/корреляции могут удалить парные доменно-важные фичи (например, `Molarity_Metal` и `Molarity_Ligand`); категориальные фичи не участвуют в проверке мультиколлинеарности.
- Целевая функция BO: сумма нормированных квадратов; веса не масштабированы под величины таргетов, σ предсказаний игнорируется; не используются EI/PI или penalisation by σ.
- Ограничения в BO: только порядок температур и широкий диапазон 0.1 < n_salt/n_acid < 10; нет проверки точки кипения (константы есть в `SOLVENT_BOILING_POINTS_C`), нет применения `STOICHIOMETRY_TARGETS`.

**Баги / несоответствия**
- `scripts/validate_physics_constraints.py` не работает — `adsorb_synthesis.physics_losses` отсутствует.
- `add_thermodynamic_features` использует неверные формулы для $K_{eq}$ и $\Delta G$ → мусорные колонки.
- Drift признаков: `Supersaturation_Index` вычисляется по-разному в обучении и в BO.
- Заполнение гидратации нулями скрывает отсутствие данных.
- BO не проверяет температуру относительно точки кипения растворителя.

**Рекомендации**
- Исправить термодинамику: не выводить $K_{eq}$ из $E$; считать $\Delta G=-RT\ln K$ только при наличии $K$, иначе оставлять NaN.
- Синхронизировать инженерные признаки (Supersaturation, гидратация) между обучением и `run_bayes_opt.py`, либо переобучить модели с новой формулой.
- Довести SALT_MASS_FIX: обучать на `log_salt_mass` с MAE/квантильной целью, на инференсе применять `expm1`.
- Усилить UQ: бутстрап/оут-оф-фолд ансамбли, калибровка σ, включение σ в BO (минимизация μ+λσ или EI/PI).
- Жёстче физические фильтры: проверка точки кипения, применение `STOICHIOMETRY_TARGETS`, фильтр $W_s \ge W_0$, реалистичные границы для $E_0$ и $E/E_0$.
- Добавить/восстановить `physics_losses.py` или убрать неработающие вызовы; включить физические штрафы/проверки в тренировочный и BO контуры.
